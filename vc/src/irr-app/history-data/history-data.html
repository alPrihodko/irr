<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
 <!-- TODO:
-->
<dom-module id="history-data">
  <template>
    <style>
      :host {
        display: inline-block;
      }

      .title {
          vertical-align: middle;
          font-size: 15px;
          padding: 5px;
          min-width: 150px;
          display: inline-block;
      }

      .card-content {
          font-size: 15px;
          min-width: 15px;
          min-height: 15px;
          vertical-align: middle;
          text-align: center;
          padding: 5px;
          margin: 5px;
          display: inline-block;
      }

      .fixed {
          font-size: 10px;
          width: 25px;
          min-width: 25px;
          ;min-height: 15px;
          vertical-align: middle;
          text-align: center;
          padding: 5px;
          margin: 5px;
          display: inline-block;
      }

      .date {
          font-size: 10px;
          width: 85px;
          min-width: 85px;
          ;min-height: 15px;
          vertical-align: middle;
          text-align: center;
          padding: 5px;
          margin: 5px;
          display: inline-block;
      }

      .col1 {
          font-size: 10px;
          width: 85px;
          min-width: 85px;
          ;min-height: 15px;
          vertical-align: middle;
          text-align: center;
          padding: 5px;
          margin: 5px;
          display: inline-block;
      }

      .normal {
        color: black;
      }

      .red {
        color: red;
      }

    </style>

    <iron-ajax
               id="historyData"
               url="http://[[host]]/control/hdata"
               handle-as="json"
               on-response="_handleResponse">
               <div>ajax</div>
    </iron-ajax>
    <template is="dom-repeat" items="{{hdata}}">
      <paper-material elevation="1" class="card-content">
        <div class="col1"><b>Garden</b></div>
        &nbsp; <div class="fixed">{{_format(item.garden.state)}}</div>
        &nbsp; <div class="fixed">{{item.garden.mode}}</div>

        <div class="col1"><b>Flowerbad</b></div>
        &nbsp; <div class="fixed">{{_format(item.flowerbad.state)}}</div>
        &nbsp; <div class="fixed">{{item.flowerbad.mode}}</div>

        &nbsp; <div class="date">{{item.date}}</div>
      </paper-material>
    </template>

  </template>

<script>
"use strict";

class HistoryData  extends Polymer.Element {
  static get is() { return 'history-data'; }

    ready() {
      super.ready();
      this.$.historyData.generateRequest();
    };


    constructor() {
        super();
        this.host = StaticGlobals.GetHostName();
    };

    _handleResponse(data) {
        console.log(data.detail.response);
        var data = data.detail.response;
        var j = 0;
        for (var i = hdata.length; i-- > 0; )
          this.hdata[j].garden.mode = data[i].GardenMode;
          this.hdata[j].garden.state = data[i].GardenState;
          this.hdata[j].flowerbad.mode = data[i].FlowerBadMode;
          this.hdata[j].flowerbad.state = data[i].FlowerBadState;
          this.hdata[j].date = new Date(data[i].Timestamp * 1e3).toLocaleString();
          j++;
        }
    };

    update() {
      this.$.historyData.generateRequest();
    };

    _format (st) {
      var ret = "Off";
      if (st) {
        ret = "On";
      }
      return ret;
    }

    static get properties() {
        return {
          hdata: {
            type: Array,
            readOnly: false,
            notify: true,
            value: function() {
                var curr = [{
                  garden: {mode:"n/a", state:false},
                  flowerbad: {mode:"n/a", state:false},
                  date: new Date()
                }];
                return curr;
              },
            reflectToAttribute: true
          },
          host: {
              type: String
              //value: "sasha123.ddns.ukrtel.net:1234"
          }
        }
    }
};

customElements.define(HistoryData.is, HistoryData);

</script>

</dom-module>
